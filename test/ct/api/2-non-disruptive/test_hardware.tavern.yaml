# MIT License
#
# (C) Copyright [2019-2022] Hewlett Packard Enterprise Development LP
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
# OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
# ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
# OTHER DEALINGS IN THE SOFTWARE.

# Tavern test cases for the Hardware State Manager (HSM) Hardware API.
# Author: Mitch Schooler, Isa Wazirzada
# Service: Hardware State Manager

# HMS test metrics test cases: 12
# GET /Hardware API response code
# GET /HardwareByFRU API response code
# GET /Hardware/{xname} node API response code
# GET /Hardware/{xname} node API response body
# GET /HardwareByFRU/{fruid} node API response code
# GET /HardwareByFRU/{fruid} node API response body
# GET /Hardware/{xname} node enclosure API response code
# GET /Hardware/{xname} node enclosure API response body
# GET /HardwareByFRU/{fruid} node enclosure API response code
# GET /HardwareByFRU/{fruid} node enclosure API response body
# TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}p0 processor API response code
# TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}p0 processor API response body
# TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} processor API response code
# TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} processor API response body
# TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}d0 dimm API response code
# TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}d0 dimm API response body
# TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} dimm API response code
# TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} dimm API response body
# GET /Hardware/Query/{xname} node API response code
# GET /Hardware/Query/{xname} node API response body
---
test_name: Query the Hardware collection

stages:
  - name: Get access token
    request:
      url: "{opaal_base_url}/token"
      method: GET
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          access_token: access_token
  # GET /Hardware API response code
  - name: Retrieve the hardware information from the Hardware collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/Hardware"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200

---
test_name: Query the HardwareByFRU collection

stages:
  - name: Get access token
    request:
      url: "{opaal_base_url}/token"
      method: GET
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          access_token: access_token
  # GET /HardwareByFRU API response code
  - name: Retrieve the hardware information from the HardwareByFRU collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/HardwareByFRU"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200

---
test_name: Query the Hardware collection for Node information

stages:
  - name: Get access token
    request:
      url: "{opaal_base_url}/token"
      method: GET
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          access_token: access_token
  - name: Retrieve a node xname from the Components collection to use in the next stage
    request:
      # also query with role=Compute since not all of the same node data is expected
      # in HSM for the master management PIT node ncn-m001 CASMHMS-4862
      url: "{hsm_base_url}/hsm/v2/State/Components?type=Node&role=Compute"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      save:
        json:
          node_xname: Components[0].ID

  # GET /Hardware/{xname} node API response code
  # GET /Hardware/{xname} node API response body
  - name: Retrieve the hardware information for a given node xname from the Hardware collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/Hardware/{node_xname}"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      json:
        HWInventoryByLocationType: "HWInvByLocNode"
        ID: "{node_xname}"
        NodeLocationInfo:
          Description: !anystr
          HostName: !anystr
          Id: !anystr
          MemorySummary:
            TotalSystemMemoryGiB: !anyint
          Name: !anystr
          ProcessorSummary:
            Count: !anyint
            Model: !anystr
        Ordinal: !anyint
        PopulatedFRU:
          FRUID: !anystr
          HWInventoryByFRUType: "HWInvByFRUNode"
          NodeFRUInfo:
            AssetTag: !anystr
            BiosVersion: !anystr
            Manufacturer: !anystr
            Model: !anystr
            PartNumber: !anystr
            SKU: !anystr
            SerialNumber: !anystr
            SystemType: !anystr
            UUID: !anystr
          Subtype: !anystr
          Type: "Node"
        Status: !anystr
        Type: "Node"
      save:
        json:
          FRUID: PopulatedFRU.FRUID

  # GET /HardwareByFRU/{fruid} node API response code
  # GET /HardwareByFRU/{fruid} node API response body
  - name: Retrieve the FRU information for a given node FRUID from the HardwareByFRU collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/HardwareByFRU/{FRUID}"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      json:
        FRUID: "{FRUID}"
        HWInventoryByFRUType: "HWInvByFRUNode"
        NodeFRUInfo:
          AssetTag: !anystr
          BiosVersion: !anystr
          Manufacturer: !anystr
          Model: !anystr
          PartNumber: !anystr
          SKU: !anystr
          SerialNumber: !anystr
          SystemType: !anystr
          UUID: !anystr
        Subtype: !anystr
        Type: "Node"
        
---
test_name: Query the Hardware collection for Node Enclosure information

stages:
  - name: Get access token
    request:
      url: "{opaal_base_url}/token"
      method: GET
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          access_token: access_token
  - name: Retrieve a node enclosure xname from the Components collection to use in the next stage
    request:
      url: "{hsm_base_url}/hsm/v2/State/Components?type=NodeEnclosure"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      save:
        json:
          node_enclosure_xname: Components[0].ID

  # GET /Hardware/{xname} node enclosure API response code
  # GET /Hardware/{xname} node enclosure API response body
  - name: Retrieve the hardware information for a given node enclosure xname from the Hardware collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/Hardware/{node_enclosure_xname}"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      json:
        HWInventoryByLocationType: "HWInvByLocNodeEnclosure"
        ID: "{node_enclosure_xname}"
        NodeEnclosureLocationInfo:
          Description: !anystr
          HostName: !anystr
          Id: !anystr
          Name: !anystr
        Ordinal: !anyint
        PopulatedFRU:
          FRUID: !anystr
          HWInventoryByFRUType: "HWInvByFRUNodeEnclosure"
          NodeEnclosureFRUInfo:
            AssetTag: !anystr
            ChassisType: !anystr
            Manufacturer: !anystr
            Model: !anystr
            PartNumber: !anystr
            SKU: !anystr
            SerialNumber: !anystr
          Subtype: !anything
          Type: "NodeEnclosure"
        Status: !anystr
        Type: "NodeEnclosure"
      save:
        json:
          FRUID: PopulatedFRU.FRUID

  # GET /HardwareByFRU/{fruid} node enclosure API response code
  # GET /HardwareByFRU/{fruid} node enclosure API response body
  - name: Retrieve the FRU information for a given node enclosure FRUID from the HardwareByFRU collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/HardwareByFRU/{FRUID}"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      json:
        FRUID: "{FRUID}"
        HWInventoryByFRUType: "HWInvByFRUNodeEnclosure"
        NodeEnclosureFRUInfo:
          AssetTag: !anystr
          ChassisType: !anystr
          Manufacturer: !anystr
          Model: !anystr
          PartNumber: !anystr
          SKU: !anystr
          SerialNumber: !anystr
        Subtype: !anystr
        Type: "NodeEnclosure"

#---
#
## The following test cases assume that a processor exists for {node_xname} with xname {node_xname}p0
## since processor xnames are not included in /State/Component queries and cannot be extracted
#test_name: Query the Hardware collection for Node Processor information
#
#stages:
#  - name: Get access token
#    request:
#      url: "{opaal_base_url}/token"
#      method: GET
#      verify: !bool "{verify}"
#    response:
#      status_code: 200
#      save:
#        json:
#          access_token: access_token
#  - name: Retrieve a node xname from the Components collection to use in the next stage
#    request:
#      url: "{hsm_base_url}/hsm/v2/State/Components?type=Node"
#      method: GET
#      verify: !bool "{verify}"
#      headers:
#        Authorization: "Bearer {access_token}"
#    response:
#      status_code: 200
#      save:
#        json:
#          node_xname: Components[0].ID
#
#  # TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}p0 processor API response code
#  # TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}p0 processor API response body
#  - name: Retrieve the hardware information for a given node processor xname from the Hardware collection
#    request:
#      url: "{hsm_base_url}/hsm/v2/Inventory/Hardware/{node_xname}p0"
#      method: GET
#      verify: !bool "{verify}"
#      headers:
#        Authorization: "Bearer {access_token}"
#    response:
#      status_code: 200
#      json:
#        HWInventoryByLocationType: "HWInvByLocProcessor"
#        ID: "{node_xname}p0"
#        Ordinal: !anyint
#        PopulatedFRU:
#          FRUID: "FRUIDfor{node_xname}p0"
#          HWInventoryByFRUType: "HWInvByFRUProcessor"
#          ProcessorFRUInfo:
#            InstructionSet: !anystr
#            Manufacturer: !anystr
#            MaxSpeedMHz: !anyint
#            Model: !anystr
#            ProcessorArchitecture: !anystr
#            ProcessorId:
#              EffectiveFamily: !anystr
#              EffectiveModel: !anystr
#              IdentificationRegisters: !anystr
#              MicrocodeInfo: !anystr
#              Step: !anystr
#              VendorID: !anystr
#            ProcessorType: "CPU"
#            TotalCores: !anyint
#            TotalThreads: !anyint
#          Subtype: !anystr
#          Type: "Processor"
#        ProcessorLocationInfo:
#          Description: !anystr
#          Id: !anystr
#          Name: !anystr
#          Socket: !anystr
#        Status: !anystr
#        Type: "Processor"
#      save:
#        json:
#          FRUID: PopulatedFRU.FRUID
#
#  # TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} processor API response code
#  # TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} processor API response body
#  - name: Retrieve the FRU information for a given node processor FRUID from the HardwareByFRU collection
#    request:
#      url: "{hsm_base_url}/hsm/v2/Inventory/HardwareByFRU/{FRUID}"
#      method: GET
#      verify: !bool "{verify}"
#      headers:
#        Authorization: "Bearer {access_token}"
#    response:
#      status_code: 200
#      json:
#        FRUID: "{FRUID}"
#        HWInventoryByFRUType: "HWInvByFRUProcessor"
#        ProcessorFRUInfo:
#          InstructionSet: !anystr
#          Manufacturer: !anystr
#          MaxSpeedMHz: !anyint
#          Model: !anystr
#          ProcessorArchitecture: !anystr
#          ProcessorId:
#            EffectiveFamily: !anystr
#            EffectiveModel: !anystr
#            IdentificationRegisters: !anystr
#            MicrocodeInfo: !anystr
#            Step: !anystr
#            VendorID: !anystr
#          ProcessorType: "CPU"
#          TotalCores: !anyint
#          TotalThreads: !anyint
#        Subtype: !anystr
#        Type: "Processor"
#
#---
#
## The following test cases assume that a memory dimm exists for {node_xname} with xname {node_xname}d0
## since memory dimm xnames are not included in /State/Component queries and cannot be extracted
#test_name: Query the Hardware collection for Node Memory information
#
#stages:
#  - name: Get access token
#    request:
#      url: "{opaal_base_url}/token"
#      method: GET
#      verify: !bool "{verify}"
#    response:
#      status_code: 200
#      save:
#        json:
#          access_token: access_token
#  - name: Retrieve a node xname from the Components collection to use in the next stage
#    request:
#      url: "{hsm_base_url}/hsm/v2/State/Components?type=Node"
#      method: GET
#      verify: !bool "{verify}"
#      headers:
#        Authorization: "Bearer {access_token}"
#    response:
#      status_code: 200
#      save:
#        json:
#          node_xname: Components[0].ID
#
#  # TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}d0 dimm API response code
#  # TODO: Disabled (CASMHMS-2809) - GET /Hardware/{xname}d0 dimm API response body
#  - name: Retrieve the hardware information for a given node memory dimm xname from the Hardware collection
#    request:
#      url: "{hsm_base_url}/hsm/v2/Inventory/Hardware/{node_xname}d0"
#      method: GET
#      verify: !bool "{verify}"
#      headers:
#        Authorization: "Bearer {access_token}"
#    response:
#      status_code: 200
#      json:
#        HWInventoryByLocationType: "HWInvByLocMemory"
#        ID: "{node_xname}d0"
#        MemoryLocationInfo:
#          Description: !anystr
#          Id: !anystr
#          MemoryLocation:
#            Channel: !anyint
#            MemoryController: !anyint
#            Slot: !anyint
#            Socket: !anyint
#          Name: !anystr
#        Ordinal: !anyint
#        PopulatedFRU:
#          FRUID: "FRUIDfor{node_xname}d0"
#          HWInventoryByFRUType: "HWInvByFRUMemory"
#          MemoryFRUInfo:
#            BaseModuleType: !anystr
#            BusWidthBits: !anyint
#            CapacityMiB: !anyint
#            DataWidthBits: !anyint
#            ErrorCorrection: !anystr
#            Manufacturer: !anystr
#            MemoryDeviceType: !anystr
#            MemoryType: "DRAM"
#            OperatingSpeedMhz: !anyint
#            PartNumber: !anystr
#            RankCount: !anyint
#            SerialNumber: !anystr
#          Subtype: !anystr
#          Type: "Memory"
#        Status: !anystr
#        Type: "Memory"
#      save:
#        json:
#          FRUID: PopulatedFRU.FRUID
#
#  # TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} dimm API response code
#  # TODO: Disabled (CASMHMS-2809) - GET /HardwareByFRU/{fruid} dimm API response body
#  - name: Retrieve the FRU information for a given node memory dimm FRUID from the HardwareByFRU collection
#    request:
#      url: "{hsm_base_url}/hsm/v2/Inventory/HardwareByFRU/{FRUID}"
#      method: GET
#      verify: !bool "{verify}"
#      headers:
#        Authorization: "Bearer {access_token}"
#    response:
#      status_code: 200
#      json:
#        FRUID: "{FRUID}"
#        HWInventoryByFRUType: "HWInvByFRUMemory"
#        MemoryFRUInfo:
#          BaseModuleType: !anystr
#          BusWidthBits: !anyint
#          CapacityMiB: !anyint
#          DataWidthBits: !anyint
#          ErrorCorrection: !anystr
#          Manufacturer: !anystr
#          MemoryDeviceType: !anystr
#          MemoryType: "DRAM"
#          OperatingSpeedMhz: !anyint
#          PartNumber: !anystr
#          RankCount: !anyint
#          SerialNumber: !anystr
#        Subtype: !anystr
#        Type: "Memory"
#
---
test_name: Call the Hardware Inventory Query API with a Node xname

stages:
  - name: Get access token
    request:
      url: "{opaal_base_url}/token"
      method: GET
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          access_token: access_token
  - name: Retrieve a node xname from the Components collection to use in the next stage
    request:
      url: "{hsm_base_url}/hsm/v2/State/Components?type=Node"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      save:
        json:
          node_xname: Components[0].ID

  # GET /Hardware/Query/{xname} node API response code
  # GET /Hardware/Query/{xname} node API response body
  - name: Retrieve the hardware information for a given node xname from the Hardware Query collection
    request:
      url: "{hsm_base_url}/hsm/v2/Inventory/Hardware/Query/{node_xname}"
      method: GET
      verify: !bool "{verify}"
      headers:
        Authorization: "Bearer {access_token}"
    response:
      status_code: 200
      verify_response_with:
        function: tavern.testutils.helpers:validate_pykwalify
        extra_kwargs:
          schema:
            type: map
            required: True
            mapping:
              XName:
                type: str
                required: True
                enum:
                  - "{node_xname}"
              Format:
                type: str
                required: True
                enum:
                  - "NestNodesOnly"
              Nodes:
                type: seq
                matching: all
                sequence:
                  - type: map
                    # Allows inventory schemas for new hardware types to be accepted
                    allowempty: True
                    mapping:
                      ID:
                        type: str
                        required: True
                        enum:
                          - "{node_xname}"
                      Type:
                        type: str
                        required: True
                        enum:
                          - "Node"
                      Ordinal:
                        type: int
                        required: True
                      Status:
                        type: str
                        required: True
                        enum:
                          - "Populated"
                      HWInventoryByLocationType:
                        type: str
                        required: True
                        enum:
                          - "HWInvByLocNode"
                      NodeLocationInfo:
                        type: map
                        required: True
                        mapping:
                          Id:
                            type: str
                            required: True
                          Name:
                            type: str
                            required: True
                          Description:
                            type: str
                            required: True
                          HostName:
                            type: str
                            required: True
                          ProcessorSummary:
                            type: map
                            required: True
                            mapping:
                              Count:
                                type: int
                                required: True
                              Model:
                                type: str
                                required: True
                          MemorySummary:
                            type: map
                            required: True
                            mapping:
                              TotalSystemMemoryGiB:
                                type: int
                                required: True
                      PopulatedFRU:
                        type: map
                        required: True
                        mapping:
                          FRUID:
                            type: str
                            required: True
                          Type:
                            type: str
                            required: True
                            enum:
                              - "Node"
                          Subtype:
                            type: str
                            required: True
                          HWInventoryByFRUType:
                            type: str
                            required: True
                            enum:
                              - "HWInvByFRUNode"
                          NodeFRUInfo:
                            type: map
                            required: True
                            mapping:
                              AssetTag:
                                type: str
                                required: True
                              BiosVersion:
                                type: str
                                required: True
                              Model:
                                type: str
                                required: True
                              Manufacturer:
                                type: str
                                required: True
                              PartNumber:
                                type: str
                                required: True
                              SerialNumber:
                                type: str
                                required: True
                              SKU:
                                type: str
                                required: True
                              SystemType:
                                type: str
                                required: True
                              UUID:
                                type: str
                                required: True
                      Processors:
                        type: seq
                        matching: all
                        sequence:
                          - type: map
                            mapping:
                              ID:
                                type: str
                                required: True
                                pattern: "{node_xname}p[0-9]+"
                              Type:
                                type: str
                                required: True
                                enum:
                                  - "Processor"
                              Ordinal:
                                type: int
                                required: True
                              Status:
                                type: str
                                required: True
                              HWInventoryByLocationType:
                                type: str
                                required: True
                                enum:
                                  - "HWInvByLocProcessor"
                              ProcessorLocationInfo:
                                type: map
                                required: True
                                mapping:
                                  Id:
                                    type: str
                                    required: True
                                  Name:
                                    type: str
                                    required: True
                                    pattern: "Processor*"
                                  Description:
                                    type: str
                                    required: True
                                  Socket:
                                    type: str
                                    required: True
                              PopulatedFRU:
                                type: map
                                required: True
                                mapping:
                                  FRUID:
                                    type: str
                                    required: True
                                  Type:
                                    type: str
                                    required: True
                                    enum:
                                      - "Processor"
                                  Subtype:
                                    type: str
                                    required: True
                                  HWInventoryByFRUType:
                                    type: str
                                    required: True
                                    enum:
                                      - "HWInvByFRUProcessor"
                                  ProcessorFRUInfo:
                                    type: map
                                    required: True
                                    # Allows the Oem key to be present as a map or a string
                                    allowempty: True
                                    mapping:
                                      InstructionSet:
                                        type: str
                                        required: True
                                      Manufacturer:
                                        type: str
                                        required: True
                                      MaxSpeedMHz:
                                        type: int
                                        required: True
                                      Model:
                                        type: str
                                        required: True
                                      SerialNumber:
                                        type: str
                                        required: True
                                      PartNumber:
                                        type: str
                                        required: True
                                      ProcessorArchitecture:
                                        type: str
                                        required: True
                                      ProcessorId:
                                        type: map
                                        required: True
                                        mapping:
                                          EffectiveFamily:
                                            type: str
                                            required: True
                                          EffectiveModel:
                                            type: str
                                            required: True
                                          IdentificationRegisters:
                                            type: str
                                            required: True
                                          MicrocodeInfo:
                                            type: str
                                            required: True
                                          Step:
                                            type: str
                                            required: True
                                          VendorID:
                                            type: str
                                            required: True
                                      ProcessorType:
                                        type: str
                                        required: True
                                        enum:
                                          - "CPU"
                                          - "GPU"
                                      TotalCores:
                                        type: int
                                        required: True
                                      TotalThreads:
                                        type: int
                                        required: True
                      Memory:
                        type: seq
                        matching: all
                        sequence:
                          - type: map
                            mapping:
                              ID:
                                type: str
                                required: True
                                pattern: "{node_xname}d[0-9]+"
                              Type:
                                type: str
                                required: True
                                enum:
                                  - "Memory"
                              Ordinal:
                                type: int
                                required: True
                              Status:
                                type: str
                                required: True
                              HWInventoryByLocationType:
                                type: str
                                required: True
                                enum:
                                  - "HWInvByLocMemory"
                              MemoryLocationInfo:
                                type: map
                                required: True
                                mapping:
                                  Id:
                                    type: str
                                    required: True
                                  Name:
                                    type: str
                                    required: True
                                  Description:
                                    type: str
                                    required: True
                                  MemoryLocation:
                                    type: map
                                    required: True
                                    mapping:
                                      Socket:
                                        type: int
                                        required: True
                                      MemoryController:
                                        type: int
                                        required: True
                                      Channel:
                                        type: int
                                        required: True
                                      Slot:
                                        type: int
                                        required: True
                              PopulatedFRU:
                                type: map
                                # PopulatedFRU data not present for all Memory entries
                                required: False
                                mapping:
                                  FRUID:
                                    type: str
                                    required: True
                                  Type:
                                    type: str
                                    required: True
                                    enum:
                                      - "Memory"
                                  Subtype:
                                    type: str
                                    required: True
                                  HWInventoryByFRUType:
                                    type: str
                                    required: True
                                    enum:
                                      - "HWInvByFRUMemory"
                                  MemoryFRUInfo:
                                    type: map
                                    required: True
                                    mapping:
                                      BaseModuleType:
                                        type: str
                                        # Missing for Memory.SKHynix.HMA84GR7CJR4NXN.*
                                        required: False
                                      BusWidthBits:
                                        type: int
                                        required: False
                                      CapacityMiB:
                                        type: int
                                        required: False
                                      DataWidthBits:
                                        type: int
                                        required: False
                                      ErrorCorrection:
                                        type: str
                                        required: False
                                      Manufacturer:
                                        type: str
                                        required: False
                                      MemoryType:
                                        type: str
                                        required: False
                                      MemoryDeviceType:
                                        type: str
                                        required: False
                                      OperatingSpeedMhz:
                                        type: int
                                        required: False
                                      PartNumber:
                                        type: str
                                        required: False
                                      RankCount:
                                        type: int
                                        # Missing for Memory.SKHynix.HMA84GR7CJR4NXN.*
                                        required: False
                                      SerialNumber:
                                        type: str
                                        required: True
                      Drives:
                        type: seq
                        required: False
                        matching: all
                        sequence:
                          - type: map
                            mapping:
                              ID:
                                type: str
                                required: True
                                pattern: "{node_xname}g[0-9]+k[0-9]+"
                              Type:
                                type: str
                                required: True
                              Ordinal:
                                type: int
                                required: True
                              Status:
                                type: str
                                required: True
                              HWInventoryByLocationType:
                                type: str
                                required: True
                                enum:
                                  - "HWInvByLocDrive"
                              DriveLocationInfo:
                                type: map
                                required: True
                                mapping:
                                  Id:
                                    type: str
                                    required: True
                                  Name:
                                    type: str
                                    required: True
                                  Description:
                                    type: str
                                    required: True
                              PopulatedFRU:
                                type: map
                                # Some nodes may have empty drive bays which is okay
                                required: False
                                allowempty: True
                                mapping:
                                  FRUID:
                                    type: str
                                    required: True
                                  Type:
                                    type: str
                                    required: True
                                  Subtype:
                                    type: str
                                    required: True
                                  HWInventoryByFRUType:
                                    type: str
                                    required: True
                                  DriveFRUInfo:
                                    type: map
                                    required: False
                                    mapping:
                                      Manufacturer:
                                        type: str
                                        required: True
                                      SerialNumber:
                                        type: str
                                        required: True
                                      PartNumber:
                                        type: str
                                        required: True
                                      Model:
                                        type: str
                                        required: True
                                      SKU:
                                        type: str
                                        required: True
                                      CapacityBytes:
                                        type: int
                                        required: True
                                      Protocol:
                                        type: str
                                        required: True
                                      MediaType:
                                        type: str
                                        required: True
                                      RotationSpeedRPM:
                                        type: int
                                        required: True
                                      BlockSizeBytes:
                                        type: int
                                        required: True
                                      CapableSpeedGbs:
                                        type: int
                                        required: True
                                      FailurePredicted:
                                        type: bool
                                        required: True
                                      EncryptionAbility:
                                        type: str
                                        required: True
                                      EncryptionStatus:
                                        type: str
                                        required: True
                                      NegotiatedSpeedGbs:
                                        type: int
                                        required: True
                                      PredictedMediaLifeLeftPercent:
                                        type: int
                                        required: True
                      NodeAccels:
                        type: seq
                        required: False
                        matching: all
                        sequence:
                          - type: map
                            mapping:
                              ID:
                                type: str
                                required: True
                                pattern: "{node_xname}a[0-9]+"
                              Type:
                                type: str
                                required: True
                                enum:
                                  - "NodeAccel"
                              Ordinal:
                                type: int
                                required: True
                              Status:
                                type: str
                                required: True
                              HWInventoryByLocationType:
                                type: str
                                required: True
                                enum:
                                  - "HWInvByLocNodeAccel"
                              NodeAccelLocationInfo:
                                type: map
                                required: True
                                mapping:
                                  Id:
                                    type: str
                                    required: True
                                  Name:
                                    type: str
                                    required: True
                                  Description:
                                    type: str
                                    required: True
                                  Socket:
                                    type: str
                                    required: True
                              PopulatedFRU:
                                type: map
                                required: True
                                mapping:
                                  FRUID:
                                    type: str
                                    required: True
                                  Type:
                                    type: str
                                    required: True
                                    enum:
                                      - "NodeAccel"
                                  Subtype:
                                    type: str
                                    required: True
                                  HWInventoryByFRUType:
                                    type: str
                                    required: True
                                    enum:
                                      - "HWInvByFRUNodeAccel"
                                  NodeAccelFRUInfo:
                                    type: map
                                    required: True
                                    # Allows the Oem key to be present as a map or a string
                                    allowempty: True
                                    mapping:
                                      InstructionSet:
                                        type: str
                                        required: True
                                      Manufacturer:
                                        type: str
                                        required: True
                                      MaxSpeedMHz:
                                        type: int
                                        required: True
                                      Model:
                                        type: str
                                        required: True
                                      SerialNumber:
                                        type: str
                                        required: True
                                      PartNumber:
                                        type: str
                                        required: True
                                      ProcessorArchitecture:
                                        type: str
                                        required: True
                                      ProcessorId:
                                        type: map
                                        matching: all
                                        mapping:
                                          EffectiveFamily:
                                            type: str
                                            required: True
                                          EffectiveModel:
                                            type: str
                                            required: True
                                          IdentificationRegisters:
                                            type: str
                                            required: True
                                          MicrocodeInfo:
                                            type: str
                                            required: True
                                          Step:
                                            type: str
                                            required: True
                                          VendorID:
                                            type: str
                                            required: True
                                      ProcessorType:
                                        type: str
                                        required: True
                                      TotalCores:
                                        type: int
                                        required: True
                                      TotalThreads:
                                        type: int
                                        required: True
                      NodeAccelRisers:
                        type: seq
                        required: False
                        matching: all
                        sequence:
                          - type: map
                            mapping:
                              ID:
                                type: str
                                required: True
                                pattern: "{node_xname}r[0-9]+"
                              Type:
                                type: str
                                required: True
                                enum:
                                  - "NodeAccelRiser"
                              Ordinal:
                                type: int
                                required: True
                              Status:
                                type: str
                                required: True
                              HWInventoryByLocationType:
                                type: str
                                required: True
                                enum:
                                  - "HWInvByLocNodeAccelRiser"
                              NodeAccelRiserLocationInfo:
                                type: map
                                required: True
                                mapping:
                                  Name:
                                    type: str
                                    required: True
                                  Description:
                                    type: str
                                    required: True
                              PopulatedFRU:
                                type: map
                                required: True
                                mapping:
                                  FRUID:
                                    type: str
                                    required: True
                                  Type:
                                    type: str
                                    required: True
                                    enum:
                                      - "NodeAccelRiser"
                                  Subtype:
                                    type: str
                                    required: True
                                  HWInventoryByFRUType:
                                    type: str
                                    required: True
                                    enum:
                                      - "HWInvByFRUNodeAccelRiser"
                                  NodeAccelRiserFRUInfo:
                                    type: map
                                    required: True
                                    # Allows the Oem key to be present as a map or a string
                                    allowempty: True
                                    mapping:
                                      PhysicalContext:
                                        type: str
                                        required: True
                                      Producer:
                                        type: str
                                        required: True
                                      SerialNumber:
                                        type: str
                                        required: True
                                      PartNumber:
                                        type: str
                                        required: True
                                      Model:
                                        type: str
                                        required: True
                                      ProductionDate:
                                        type: str
                                        required: True
                                      Version:
                                        type: str
                                        required: True
                                      EngineeringChangeLevel:
                                        type: str
                                        required: True
                      NodeHsnNics:
                        type: seq
                        required: False
                        matching: all
                        sequence:
                          - type: map
                            mapping:
                              ID:
                                type: str
                                required: True
                                pattern: "{node_xname}h[0-9]+"
                              Type:
                                type: str
                                required: True
                                enum:
                                  - "NodeHsnNic"
                              Ordinal:
                                type: int
                                required: True
                              Status:
                                type: str
                                required: True
                              HWInventoryByLocationType:
                                type: str
                                required: True
                                enum:
                                  - "HWInvByLocNodeHsnNic"
                              NodeHsnNicLocationInfo:
                                type: map
                                required: True
                                mapping:
                                  Id:
                                    type: str
                                    required: True
                                  Name:
                                    type: str
                                    required: True
                                  Description:
                                    type: str
                                    required: True
                              PopulatedFRU:
                                type: map
                                required: True
                                mapping:
                                  FRUID:
                                    type: str
                                    required: True
                                  Type:
                                    type: str
                                    required: True
                                    enum:
                                      - "NodeHsnNic"
                                  Subtype:
                                    type: str
                                    required: True
                                  HWInventoryByFRUType:
                                    type: str
                                    required: True
                                    enum:
                                      - "HWInvByFRUNodeHsnNic"
                                  NodeHsnNicFRUInfo:
                                    type: map
                                    required: True
                                    mapping:
                                      Manufacturer:
                                        type: str
                                        required: True
                                      Model:
                                        type: str
                                        required: True
                                      PartNumber:
                                        type: str
                                        required: True
                                      SKU:
                                        type: str
                                        required: False
                                      SerialNumber:
                                        type: str
                                        required: True
